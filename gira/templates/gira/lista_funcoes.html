{% extends 'gira/base.html' %}

{% block content %}
<div class="container my-4">
  <div class="mb-4">
    {% if gira %}
      <h2 class="text-white">
        {{ gira.titulo }}
        <small class="text-white-50">– {{ gira.data_hora|date:"d/m/Y H:i" }}</small>
      </h2>
      {% if gira.linha %}
        <p class="text-white-50">Linha: {{ gira.linha }}</p>
      {% endif %}
    {% else %}
      <div class="alert alert-warning">Nenhuma gira encontrada.</div>
    {% endif %}
  </div>

  <!-- BLOCO: CAMBONES -->
  <section class="mb-4">
    <h4 class="mb-3">Cambones</h4>

    {% if cambones %}
      <div class="row">
        {% for f in cambones %}
          <div class="col-12 mb-2">
            <div class="card shadow-sm">
              <div class="card-body p-2">
                <div class="fw-semibold">{{ f.medium_nome|default:"—" }}</div>
                <div class="text-muted small">{{ f.pessoa_nome|default:"—" }}</div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted fst-italic">Nenhum cambone cadastrado.</p>
    {% endif %}
  </section>

  <hr>

  <!-- BLOCO: ORGANIZAÇÃO -->
  <section class="mb-4">
    <h4 class="mb-3">Organização</h4>

    {% if organizacao %}
      <div class="row">
        {% for f in organizacao %}
          <div class="col-12 mb-2">
            <div class="card shadow-sm position-relative">
              <!-- Badge superior direito: "Vago" se estiver vaga -->
              {% if f.status|lower == 'vaga' %}
                <span class="badge bg-danger position-absolute" style="right:10px; top:10px;">Vago</span>
              {% endif %}

              <div class="card-body p-2 d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-semibold">{{ f.descricao|default:f.tipo }}</div>
                  <div class="text-muted small">{{ f.pessoa_nome|default:"-" }}</div>
                </div>
                <div class="text-end">
                  {% if f.status|lower == 'vaga' %}
                    <button class="btn btn-sm btn-success" disabled>Assumir</button>
                  {% else %}
                    <!-- nenhum botão quando preenchida -->
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted fst-italic">Nenhuma função de organização cadastrada.</p>
    {% endif %}
  </section>

  <hr>

  <!-- BLOCO: LIMPEZA -->
  <section class="mb-4">
    <h4 class="mb-3">Limpeza</h4>

    {% if limpeza %}
      <div class="row">
        {% for f in limpeza %}
          <div class="col-12 mb-2">
            <div class="card shadow-sm position-relative">
              {% if f.status|lower == 'vaga' %}
                <span class="badge bg-danger position-absolute" style="right:10px; top:10px;">Vago</span>
              {% endif %}

              <div class="card-body p-2 d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-semibold">{{ f.descricao|default:f.tipo }}</div>
                  <div class="text-muted small">{{ f.pessoa_nome|default:"-" }}</div>
                </div>
                <div class="text-end">
                  {% if f.status|lower == 'vaga' %}
                    <a href="{% url 'gira:assumir_funcao' f.id %}" class="btn btn-sm btn-success">Assumir</a>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted fst-italic">Nenhuma função de limpeza cadastrada.</p>
    {% endif %}
  </section>

  <hr>

</div>

<style>
/* pequenas correções de visual */
.text-white-50 { color: rgba(255,255,255,0.7); }
.card .badge { font-size: 0.75rem; padding: 0.3rem 0.5rem; }
@media (max-width: 576px) {
  /* garante que botões e badges se alinhem bem no mobile */
  .card .badge { top: 8px; right: 8px; }
}
</style>
{% endblock %}
